

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Nose を使ったテスト &mdash; Python School 1.5.0 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.5.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="Python School 1.5.0 documentation" href="../index.html" />
    <link rel="up" title="プロジェクトの構成" href="index.html" />
    <link rel="next" title="構成、ビルドのツール" href="tools-1.html" />
    <link rel="prev" title="標準モジュールを使ったテスト" href="tests-1.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Python School 1.5.0 documentation</span></a></h1>
        <h2 class="heading"><span>Nose を使ったテスト</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="tests-1.html">標準モジュールを使ったテスト</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tools-1.html">構成、ビルドのツール</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="nose">
<h1>Nose を使ったテスト<a class="headerlink" href="#nose" title="Permalink to this headline">¶</a></h1>
<p>個別のテストファイルに <tt class="docutils literal"><span class="pre">if</span> <span class="pre">__name__</span> <span class="pre">==</span> <span class="pre">'__main__':</span></tt> を記述するのは煩雑なので、
テストの実行には <a class="reference external" href="http://readthedocs.org/docs/nose/en/latest/">nose</a> というモジュールを使います。</p>
<div class="section" id="id2">
<h2>Nose のインストール<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p><tt class="file docutils literal"><span class="pre">requirements.txt</span></tt> に <em>nose</em> の記述を追加して、 <strong class="command">pip</strong> を使ってインストールします。
インストールできると、 <strong class="command">nosetests</strong> が使えるようになります。</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p><tt class="file docutils literal"><span class="pre">requirements.txt</span></tt></p>
<div class="last highlight-python"><div class="highlight"><pre><span class="n">nose</span>
</pre></div>
</div>
</div>
<div class="highlight-python"><pre>$ pip install -r requirements.txt
$ nosetests -V
nosetests version 1.1.2</pre>
</div>
<p><tt class="docutils literal"><span class="pre">--help</span></tt> オプションを付けて実行すると利用可能なオプションを一覧で確認できます。</p>
</div>
<div class="section" id="id3">
<h2>簡単な実行方法<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><strong class="command">nosetests</strong> は <cite>test</cite> から始まる関数を自動で認識してくれます。
<a class="reference internal" href="tests-1.html"><em>標準モジュールを使ったテスト</em></a> で記述したスクリプトにはテストが含まれていますので、まずは確認してみます。</p>
<div class="highlight-python"><pre>$ nosetests --collect-only -v
test (fibonacci_test.FibonacciTest) ... ok
test (fibonacci_test2.FibonacciTest) ... ok
test_invalid_argument (fibonacci_test2.FibonacciTest) ... ok
test (fibonacci_test3.FibonacciTest) ... ok
test_invalid_argument (fibonacci_test3.FibonacciTest) ... ok
test_引数が日本語の場合は？ (fibonacci_test3.FibonacciTest) ... ok
fibonacci_test3.test_undefined ... ok

----------------------------------------------------------------------
Ran 7 tests in 0.016s

OK</pre>
</div>
<p>複数のスクリプトからテストケースを収集できていることが分かります。
実際に実行してみます。</p>
<div class="highlight-python"><pre>$ nosetests -v 2&gt;tests.txt

$ head -n 10 tests.txt
test (fibonacci_test.FibonacciTest) ... ok
test (fibonacci_test2.FibonacciTest) ... ok
test_invalid_argument (fibonacci_test2.FibonacciTest) ... ok
test (fibonacci_test3.FibonacciTest) ... ok
test_invalid_argument (fibonacci_test3.FibonacciTest) ... ok
test_引数が日本語の場合は？ (fibonacci_test3.FibonacciTest) ... ERROR
fibonacci_test3.test_undefined ... ERROR

======================================================================
ERROR: test_引数が日本語の場合は？ (fibonacci_test3.FibonacciTest)

$ tail -n 7 tests.txt
    self.test(*self.arg)
TypeError: test_undefined() takes exactly 1 argument (0 given)

----------------------------------------------------------------------
Ran 7 tests in 0.027s

FAILED (errors=2)</pre>
</div>
<p>確かにエラーになります。</p>
</div>
<div class="section" id="id4">
<h2>レポーティング<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>継続的にテストを実行させる場合、それぞれの実行結果をどのように保存すべきを考える必要があります。
多くの場合は Jenkins などの CI ツールでジョブを自動化することになるでしょう。
たいていのツールは xUnit のレポートを表示できます。
そこで、 <strong class="command">nosetests</strong> の方でも XML 形式のレポートを出力できるようになっています。</p>
<p>レポートを出力し、XML を整形して表示</p>
<div class="highlight-python"><pre>$ nosetests --with-xunit

$ xmllint --format nosetests.xml |head -n 5
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;testsuite name="nosetests" tests="7" errors="2" failures="0" skip="0"&gt;
  &lt;testcase classname="fibonacci_test.FibonacciTest" name="test" time="0.001"/&gt;
  &lt;testcase classname="fibonacci_test2.FibonacciTest" name="test" time="0.001"/&gt;
  &lt;testcase classname="fibonacci_test2.FibonacciTest" name="test_invalid_argument" time="0.000"/&gt;</pre>
</div>
<p>これらを繋ぎ込むことで、テスト結果を確認しながら実装を進めていくことが可能になります。</p>
<p>テストの数が増加してきた場合には <a class="reference external" href="http://www.teamst.org/">TestLink</a> などが有効です。</p>
<p>何をどこまでテストすべきかは、 <a class="reference external" href="http://dev.ariel-networks.com/articles/testpress-vol9/part1/">パッケージソフト開発のテスト体制</a> の記事を参考にして考えてみましょう。</p>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="tests-1.html">標準モジュールを使ったテスト</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="tools-1.html">構成、ビルドのツール</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, KITAZAKI Shigeru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>