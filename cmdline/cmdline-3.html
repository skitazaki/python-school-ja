

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>設定情報を管理する &mdash; Python School 1.3.0rc documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.0rc',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="Python School 1.3.0rc documentation" href="../index.html" />
    <link rel="up" title="コマンドライン操作" href="index.html" />
    <link rel="next" title="シェルコマンドを実行する" href="cmdline-4.html" />
    <link rel="prev" title="ファイルシステムの階層を辿る" href="cmdline-2.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Python School 1.3.0rc documentation</span></a></h1>
        <h2 class="heading"><span>設定情報を管理する</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="cmdline-2.html">ファイルシステムの階層を辿る</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cmdline-4.html">シェルコマンドを実行する</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="id1">
<h1>設定情報を管理する<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>プログラムの設定情報を管理する方法はたくさんあります。
ここでは、環境変数の利用と、設定ファイルの利用を紹介します。</p>
<p>モジュールが環境変数を参照することもあります。
よく使うモジュールでは <cite>urllib2</cite> が挙げられます。
プロキシを使った環境では、環境変数 <tt class="docutils literal"><span class="pre">http_proxy</span></tt> に依存します。</p>
<div class="section" id="id2">
<h2>環境変数の扱い<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>os.environ で環境変数を設定、参照できます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">os</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%-20s</span><span class="se">\t</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">VERSIONER_PYTHON_PREFER_32_BIT  no</span>
<span class="go">TERM_PROGRAM_VERSION    299</span>
<span class="go">WINDOW                  1</span>
<span class="go">LOGNAME                 shigeru</span>
<span class="go">USER                    shigeru</span>
<span class="go">HOME                    /Users/shigeru</span>
<span class="go">PATH                    /Users/shigeru/projects/python-school-ja/bin:/opt/local/bin:/opt/local/sbin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/usr/X11/bin</span>
<span class="go">PS1                     (python-school-ja)\n\e[1;4;33m\u \w\e[m [\#]\n$</span>
<span class="go">( ... もっと続く ... )</span>
</pre></div>
</div>
<p>インタープリタを起動する前に環境変数を設定しておくと、起動中にその値を参照できます。
サーバごとに設定値を変更したい場合には知っておくと便利でしょう。</p>
</div>
<div class="section" id="id3">
<h2>設定ファイルの扱い<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>Python スクリプトをそのまま使う (<tt class="file docutils literal"><span class="pre">settings.py</span></tt> など)</li>
<li><a class="reference external" href="http://docs.python.org/library/configparser.html">ConfigParser</a> を使う (<em>.ini</em> / <em>.cfg</em> 形式)</li>
<li>JSON を使う (Python 2.6 から標準モジュール)</li>
<li>YAML を使う (<a class="reference external" href="http://pyyaml.org/wiki/PyYAML">pyyaml</a> をインストール)</li>
<li>自前で解析器を実装する (ダメなパターンが多い...)</li>
</ul>
<p>手っ取り早く始めるためには Python スクリプトをそのまま使いましょう。
構造については Django の設定ファイルを参考にすると良いでしょう。</p>
<p><tt class="file docutils literal"><span class="pre">settings.py</span></tt> (geodjango の初期設定から抜粋)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DEBUG</span> <span class="o">=</span> <span class="bp">True</span>
<span class="n">TEMPLATE_DEBUG</span> <span class="o">=</span> <span class="n">DEBUG</span>

<span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.contrib.gis.db.backends.postgis&#39;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;template1&#39;</span><span class="p">,</span>
        <span class="s">&#39;USER&#39;</span><span class="p">:</span> <span class="s">&#39;DOTCLOUD_DB_SQL_LOGIN&#39;</span><span class="p">,</span>
        <span class="s">&#39;PASSWORD&#39;</span><span class="p">:</span> <span class="s">&#39;DOTCLOUD_DB_SQL_PASSWORD&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;DOTCLOUD_DB_SQL_HOST&#39;</span><span class="p">,</span>
        <span class="s">&#39;PORT&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="s">&#39;12345&#39;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="n">LOGGING</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;disable_existing_loggers&#39;</span><span class="p">:</span> <span class="bp">False</span><span class="p">,</span>
    <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;mail_admins&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;django.utils.log.AdminEmailHandler&#39;</span>
        <span class="p">}</span>
    <span class="p">},</span>
    <span class="s">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;django.request&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;mail_admins&#39;</span><span class="p">],</span>
            <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">,</span>
            <span class="s">&#39;propagate&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">cmdline-3.py</span></tt> (<tt class="file docutils literal"><span class="pre">settings.py</span></tt> は同じディレクトリに配置)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="kn">import</span> <span class="nn">settings</span>

<span class="n">pprint</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="nb">dir</span><span class="p">(</span><span class="n">settings</span><span class="p">))</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">DATABASES</span><span class="p">)</span>
<span class="n">pprint</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LOGGING</span><span class="p">)</span>
</pre></div>
</div>
<p>実行結果</p>
<div class="highlight-python"><pre>$ python cmdline-3.py
&lt;module 'settings' from '/Users/shigeru/projects/python-school-ja/src/settings.pyc'&gt;
['DATABASES',
 'DEBUG',
 'LOGGING',
 'TEMPLATE_DEBUG',
 '__builtins__',
 '__doc__',
 '__file__',
 '__name__',
 '__package__']
True
{'default': {'ENGINE': 'django.contrib.gis.db.backends.postgis',
             'HOST': 'DOTCLOUD_DB_SQL_HOST',
             'NAME': 'template1',
             'PASSWORD': 'DOTCLOUD_DB_SQL_PASSWORD',
             'PORT': 12345,
             'USER': 'DOTCLOUD_DB_SQL_LOGIN'}}
{'disable_existing_loggers': False,
 'handlers': {'mail_admins': {'class': 'django.utils.log.AdminEmailHandler',
                              'level': 'ERROR'}},
 'loggers': {'django.request': {'handlers': ['mail_admins'],
                                'level': 'ERROR',
                                'propagate': True}},
 'version': 1}</pre>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="cmdline-2.html">ファイルシステムの階層を辿る</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cmdline-4.html">シェルコマンドを実行する</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2011, KITAZAKI Shigeru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>