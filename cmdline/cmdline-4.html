<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>シェルコマンドを実行する &mdash; Python School 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <link rel="top" title="Python School 2.0.0 documentation" href="../index.html" />
    <link rel="up" title="コマンドライン操作" href="index.html" />
    <link rel="next" title="SSH を使う" href="cmdline-5.html" />
    <link rel="prev" title="設定情報を読み込む" href="cmdline-3.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Python School 2.0.0 documentation</span></a></h1>
        <h2 class="heading"><span>シェルコマンドを実行する</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="cmdline-3.html">設定情報を読み込む</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cmdline-5.html">SSH を使う</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="id1">
<h1>シェルコマンドを実行する<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p><em>subprocess</em> モジュールを使うことでシェルコマンドを実行できます。</p>
<ul class="simple">
<li><a class="reference external" href="https://docs.python.org/3.4/library/subprocess.html">17.5. subprocess — Subprocess management</a> (公式ドキュメント)</li>
</ul>
<div class="section" id="id2">
<h2>シェルコマンドの実行<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>もっとも簡単なコマンドの実行方法は <tt class="docutils literal"><span class="pre">subprocess.call()</span></tt> の呼び出しです。</p>
<p>コマンドプロンプトで対話シェルに対して実行します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">args</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;python&#39;</span><span class="p">,</span> <span class="s">&#39;-V&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">subprocess</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p><cite>subprocess</cite> モジュールは以下のモジュールの置き換えになりますので、
ちょっと古いブログ記事などを読む場合は気をつけましょう。</p>
<ul class="simple">
<li>os.system</li>
<li>os.spawn*</li>
<li>os.popen*</li>
<li>popen2.*</li>
<li>commands.*</li>
</ul>
<p>公式ドキュメントには、それぞれのモジュールで書かれたスクリプトを置き換える方法も掲載されています。</p>
</div>
<div class="section" id="id3">
<h2>コマンドの実行を待つ<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p>少し混み入ったことを実装する場合には <tt class="docutils literal"><span class="pre">Popen</span></tt> を使います。
<tt class="docutils literal"><span class="pre">subprocess.call()</span></tt> はこれのラッパーなわけです。</p>
<p>大きめのファイルがあるディレクトリに対して、 <strong class="command">du</strong> コマンドを実行してみましょう。(Linux)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">subprocess</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s">&#39;du&#39;</span><span class="p">,</span> <span class="s">&#39;-sh&#39;</span><span class="p">,</span> <span class="s">&#39;/var/log&#39;</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;[Before wait] Return Code is &quot;{}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">))</span>
<span class="n">p</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>
<span class="k">print</span><span class="p">(</span><span class="s">&#39;[After wait] Return Code is &quot;{}&quot;.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">returncode</span><span class="p">))</span>
</pre></div>
</div>
<p>呼び出したプロセスが終了するのを待ち受けたことが分かります。</p>
<p>途中結果を待ち受けるには <tt class="docutils literal"><span class="pre">poll()</span></tt> 、プロセスにデータを渡すには <tt class="docutils literal"><span class="pre">communicate()</span></tt> を使います。
timeout の指定もできますので、対話的なコマンドラインツールを実装するときにはマニュアルを読み返しましょう。</p>
</div>
<div class="section" id="id4">
<h2>宿題<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>指定ディレクトリ配下の直近１週間で更新されたファイルを別のディレクトリにコピーしてください。
前回の実行でコピーしてあれば何もしないでください。</li>
<li>1. のスクリプトで、コピー元とコピー先のディレクトリを INI 形式で管理してください。
ひとつの設定ファイルで複数の実行環境を切り替えられるようにしてください。</li>
<li>Wikipedia の XML 形式の記事概要ファイルをダウンロードして解凍するスクリプトを記述してください。
<a class="reference external" href="http://dumps.wikimedia.org/jawiki/latest/">Index of /jawiki/latest/</a> - dumps.wikimedia.org からダウンロードできます。
データ量が大きいため、進捗が分かるように標準出力に何らかの情報を表示してください。</li>
</ol>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Linux や Mac の場合は <strong class="command">wget</strong> や <strong class="command">curl</strong> でダウンロードできますが、
Windows の場合はそうしたツールが組み込まれていません。
また、&#8221;.tar.gz&#8221; や &#8221;.tar.bz2&#8221; を解凍する方法も標準では提供されていません。
Python を使うとマルチプラットフォームに対応したツールを実装できます。</p>
</div>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="cmdline-3.html">設定情報を読み込む</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="cmdline-5.html">SSH を使う</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2014, KITAZAKI Shigeru.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>