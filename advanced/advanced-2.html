

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>モジュールのインポート方法いろいろ &mdash; Python School 1.4.0 documentation</title>
    
    <link rel="stylesheet" href="../static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="../static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.4.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../static/jquery.js"></script>
    <script type="text/javascript" src="../static/underscore.js"></script>
    <script type="text/javascript" src="../static/doctools.js"></script>
    <script type="text/javascript" src="../_static/theme_extras.js"></script>
    <link rel="top" title="Python School 1.4.0 documentation" href="../index.html" />
    <link rel="up" title="発展的なことがら" href="index.html" />
    <link rel="next" title="ネットワークプログラミング" href="advanced-3.html" />
    <link rel="prev" title="デコレータ" href="advanced-1.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="../index.html">
          <span>Python School 1.4.0 documentation</span></a></h1>
        <h2 class="heading"><span>モジュールのインポート方法いろいろ</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="advanced-1.html">デコレータ</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="advanced-3.html">ネットワークプログラミング</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="id1">
<h1>モジュールのインポート方法いろいろ<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h1>
<p>モジュールのインポートには <tt class="docutils literal"><span class="pre">import</span></tt> 文を使いますが、
実行環境によってインポート可能なモジュールが異なる場合もあります。
この問題に対処するために、 try-catch を使うこともあります。</p>
<div class="section" id="id2">
<h2>標準モジュールのインポート<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h2>
<p>標準モジュールのインポートはこれまでも見てきた通りです。
インタープリタを起動してから即座にインポートできます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">unittest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">unittest</span><span class="p">)</span>
<span class="go">&lt;type &#39;module&#39;&gt;</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">type()</span></tt> は組み込み関数で、引数の「型」を返します。</p>
<p>インポートしたモジュールオブジェクトからは、 <tt class="docutils literal"><span class="pre">dir()</span></tt> 関数でメソッド一覧を取得できます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">availables</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="n">unittest</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">availables</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">row</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="gp">... </span>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
<span class="gp">... </span>        <span class="k">print</span> <span class="s">&quot;</span><span class="si">%20s%20s%20s%20s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="gp">... </span>        <span class="n">row</span> <span class="o">=</span> <span class="p">[]</span>
<span class="gp">...</span>
<span class="go">       BaseTestSuite    FunctionTestCase            SkipTest            TestCase</span>
<span class="go">          TestLoader         TestProgram          TestResult           TestSuite</span>
<span class="go">      TextTestResult      TextTestRunner     _TextTestResult             __all__</span>
<span class="go">        __builtins__             __doc__            __file__            __name__</span>
<span class="go">         __package__            __path__          __unittest                case</span>
<span class="go">   defaultTestLoader     expectedFailure       findTestCases    getTestCaseNames</span>
<span class="go">      installHandler              loader                main           makeSuite</span>
<span class="go">      registerResult       removeHandler        removeResult              result</span>
<span class="go">              runner             signals                skip              skipIf</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="go">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&quot;</span><span class="si">%20s%20s%20s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<span class="go">          skipUnless               suite                util</span>
</pre></div>
</div>
</div>
<div class="section" id="id3">
<h2>サードパーティモジュールのインポート<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h2>
<p><strong class="command">easy_install</strong> あるいは <strong class="command">pip</strong> でインストールしたモジュールも同様に読み込めます。
API ドキュメントがソースに記述されている場合には、 <tt class="docutils literal"><span class="pre">help()</span></tt> 関数で表示できます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">docutils</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">docutils</span><span class="p">)</span>

<span class="go">(スクリーンビューアーに切り替わる)</span>

<span class="go">Help on package docutils:</span>

<span class="go">NAME</span>
<span class="go">    docutils - This is the Docutils (Python Documentation Utilities) package.</span>

<span class="go">FILE</span>
<span class="go">    /Users/shigeru/projects/python-school-ja/lib/python2.7/site-packages/docutils/__init__.py</span>

<span class="go">DESCRIPTION</span>
<span class="go">    Package Structure</span>
<span class="go">    =================</span>

<span class="go">(ヘルプメッセージが続く...)</span>
</pre></div>
</div>
<p>モジュールを別名でインポートしたい場合には <tt class="docutils literal"><span class="pre">as</span></tt> を使います。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">json</span> <span class="kn">as</span> <span class="nn">simplejson</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">json</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n">&lt;module&gt;</span>
<span class="gr">NameError</span>: <span class="n">name &#39;json&#39; is not defined</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">simplejson</span>
<span class="go">&lt;module &#39;json&#39; from &#39;/System/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/json/__init__.pyc&#39;&gt;</span>
</pre></div>
</div>
<p>こうすることで、 <em>simplejson</em> モジュールをベースに書かれたスクリプトを移行できます。</p>
</div>
<div class="section" id="id4">
<h2>自作ライブラリのインポート<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h2>
<p>自分で記述したスクリプトをインポートして再利用できます。
パターンとしては三つあり、普通は二つ目か三つ目を使います。</p>
<ol class="arabic simple">
<li>実行時のディレクトリにスクリプトを置くだけ</li>
<li>ディレクトリを用意して、そこに階層化して配置する</li>
<li><tt class="file docutils literal"><span class="pre">setup.py</span></tt> を使ってインストールする</li>
</ol>
<div class="section" id="id5">
<h3>実行時のディレクトリにスクリプトを置くだけ<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p><tt class="file docutils literal"><span class="pre">cmdline.py</span></tt> というファイルに共通処理を記述し、
<tt class="file docutils literal"><span class="pre">mylib-sample.py</span></tt> というスクリプトから使う場合は次のようになります。</p>
<p><tt class="file docutils literal"><span class="pre">cmdline.py</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;Simple Command Line Utility.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">optparse</span>


<span class="k">def</span> <span class="nf">parse_args</span><span class="p">(</span><span class="n">doc</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Parse arguments and sets up logging verbosity.</span>

<span class="sd">    :rtype: normal options and arguments as tuple.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-o&quot;</span><span class="p">,</span> <span class="s">&quot;--output&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;output&quot;</span><span class="p">,</span>
        <span class="n">help</span><span class="o">=</span><span class="s">&quot;output file&quot;</span><span class="p">,</span> <span class="n">metavar</span><span class="o">=</span><span class="s">&quot;FILE&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-v&quot;</span><span class="p">,</span> <span class="s">&quot;--verbose&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;verbose&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;verbose mode&quot;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-q&quot;</span><span class="p">,</span> <span class="s">&quot;--quiet&quot;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&quot;quiet&quot;</span><span class="p">,</span>
        <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s">&quot;quiet mode&quot;</span><span class="p">)</span>

    <span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">opts</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">)</span>
    <span class="k">elif</span> <span class="ow">not</span> <span class="n">opts</span><span class="o">.</span><span class="n">quiet</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">opts</span><span class="p">,</span> <span class="n">args</span>

<span class="c"># vim: set et ts=4 sw=4 cindent fileencoding=utf-8 :</span>
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">mylib-sample.py</span></tt></p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">cmdline</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">----- cmdline module -----</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="k">print</span> <span class="nb">dir</span><span class="p">(</span><span class="n">cmdline</span><span class="p">)</span>

<span class="k">print</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">----- parse_args() document -----</span><span class="se">\n</span><span class="s">&quot;</span>
<span class="k">print</span> <span class="n">cmdline</span><span class="o">.</span><span class="n">parse_args</span><span class="o">.</span><span class="n">__doc__</span>
</pre></div>
</div>
<p>実行結果</p>
<div class="highlight-python"><pre>$ python mylib-sample.py

----- cmdline module -----

['__builtins__', '__doc__', '__file__', '__name__', '__package__', 'logging', 'optparse', 'parse_args']

----- parse_args() document -----

Parse arguments and sets up logging verbosity.

    :rtype: normal options and arguments as tuple.</pre>
</div>
</div>
<div class="section" id="id6">
<h3>ディレクトリを用意して、そこに階層化して配置する<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>上記の方法だと、標準モジュールやその他のモジュールと名前がバッティングしてしまう可能性があります。
また、機能の単位やモジュール同士の依存関係などが全く分かりません。</p>
<p>そこで、通常は階層構造を持たせて管理することになります。
モジュールの階層は基本的にはディレクトリの階層に一致しますが、
それぞれのディレクトリには <tt class="file docutils literal"><span class="pre">__init__.py</span></tt> という特殊ファイルが
配置されていなければなりません。
<tt class="file docutils literal"><span class="pre">__init__.py</span></tt> は空のファイルでも構いませんし、
そこに Python スクリプトを記述しても構いません。</p>
<p>前述の <tt class="file docutils literal"><span class="pre">cmdline.py</span></tt> を <em>pyschool</em> というディレクトリに置き、
<em>pyschool</em> ディレクトリに空の <tt class="file docutils literal"><span class="pre">__init__.py</span></tt> ファイルを置きます。</p>
<div class="highlight-python"><pre>$ tree pyschool/
pyschool/
├── __init__.py
└── cmdline.py</pre>
</div>
<p>モジュールの情報を確認してみます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pyschool.cmdline</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">help</span><span class="p">(</span><span class="n">pyschool</span><span class="o">.</span><span class="n">cmdline</span><span class="p">)</span>
<span class="go">Help on module pyschool.cmdline in pyschool:</span>

<span class="go">NAME</span>
<span class="go">    pyschool.cmdline - Simple Command Line Utility.</span>

<span class="go">FILE</span>
<span class="go">    /Users/shigeru/projects/python-school-ja/src/pyschool/cmdline.py</span>

<span class="go">FUNCTIONS</span>
<span class="go">    parse_args(doc=None)</span>
<span class="go">        Parse arguments and sets up logging verbosity.</span>

<span class="go">        :rtype: normal options and arguments as tuple.</span>


<span class="gp">&gt;&gt;&gt; </span><span class="nb">dir</span><span class="p">(</span><span class="n">pyschool</span><span class="o">.</span><span class="n">cmdline</span><span class="p">)</span>
<span class="go">[&#39;__builtins__&#39;, &#39;__doc__&#39;, &#39;__file__&#39;, &#39;__name__&#39;, &#39;__package__&#39;, &#39;logging&#39;, &#39;optparse&#39;, &#39;parse_args&#39;]</span>
</pre></div>
</div>
<p>階層が深くなっていくと、いつもパッケージ名を付けるのは冗長です。
そこで、 <tt class="docutils literal"><span class="pre">from</span></tt> を使ってインポートすることもあります。
たとえば、 <tt class="docutils literal"><span class="pre">pyschool.cmdline.parse_args()</span></tt> の場合は次のようにします。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pyschool.cmdline</span> <span class="kn">import</span> <span class="n">parse_args</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">parse_args</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">parse_args</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">parse_args</span><span class="o">.</span><span class="n">func_name</span>
<span class="go">pyschool.cmdline parse_args parse_args</span>
</pre></div>
</div>
<p>あるパッケージからすべての機能をインポートすることも可能です。
この場合、&#8221;*&#8221; を使います。
しかし、「すべて」が何を意味するかは <tt class="file docutils literal"><span class="pre">__init__.py</span></tt> の <tt class="docutils literal"><span class="pre">__all__</span></tt> 変数によって変わってきます。
詳しくは公式チュートリアルを参照してください。</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.python.org/tutorial/modules.html#packages">6.4. Packages</a> (The Python Tutorial)</li>
</ul>
</div>
<div class="section" id="setup-py">
<h3><tt class="file docutils literal"><span class="pre">setup.py</span></tt> を使ってインストールする<a class="headerlink" href="#setup-py" title="Permalink to this headline">¶</a></h3>
<p><tt class="file docutils literal"><span class="pre">setup.py</span></tt> を使うと、手元の環境にインストールして使えるようになります。
インストールしておくと、環境変数を設定しなくても、どのディレクトリでも使えますから便利です。</p>
<p>詳しくはこちらのガイドを読んでください。</p>
<ul class="simple">
<li><a class="reference external" href="http://www.ibm.com/developerworks/jp/opensource/library/os-pythonpackaging/">Python のパッケージ化に関するガイド</a> - IBM developerWorks</li>
</ul>
</div>
</div>
<div class="section" id="id7">
<h2>Python のバージョン違いを考慮したインポート<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h2>
<p><cite>urlparse</cite> モジュールに <tt class="docutils literal"><span class="pre">parse_qs()</span></tt> という関数が定義されています。
URL のクエリストリング (&#8221;?&#8221; の後ろの部分) を解析してくれる関数です。</p>
<ul class="simple">
<li><a class="reference external" href="http://docs.python.org/library/urlparse.html#urlparse.parse_qs">http://docs.python.org/library/urlparse.html#urlparse.parse_qs</a></li>
</ul>
<p>ドキュメントには次のように記述されています。</p>
<div class="highlight-python"><pre>New in version 2.6: Copied from the cgi module.

[日本語] バージョン 2.6 で新しく追加されました。cgi モジュールからコピーしています。</pre>
</div>
<p><cite>cgi</cite> モジュールの <tt class="docutils literal"><span class="pre">parse_qs()</span></tt> ドキュメントには次のように記述されています。</p>
<div class="highlight-python"><pre>This function is deprecated in this module.
Use urlparse.parse_qs() instead. It is maintained here only for backward compatiblity.

[日本語] このモジュールにおけるこの関数は非推奨です。
urlparse.parse_qs() を代わりに使ってください。
ここでの記述は後方互換性のためだけに残されています。</pre>
</div>
<p>ということで、Python 2.4 と Python 2.7 の両方で動作するスクリプトを記述するためには、
ちょっとした気遣いが必要になります。</p>
<p>モジュールをインポートできない場合、 <tt class="docutils literal"><span class="pre">ImportError</span></tt> という例外が発生します。
そこで、この例外を捕まえてあげることで、利用可能なモジュールを選択的に読み込むことが可能です。
スクリプトにすると次のようになります。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">urlparse</span> <span class="kn">import</span> <span class="n">parse_qs</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cgi</span> <span class="kn">import</span> <span class="n">parse_qs</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">ImportError</span></tt> によって利用するモジュールを切り替える書き方は、
ライブラリのコードには散見されます。</p>
<p>実行時に最適な JSON ライブラリを選択してくれる <em>anyjson</em> のソースコードなどを読んでみると良いでしょう。</p>
<ul class="simple">
<li><a class="reference external" href="http://pypi.python.org/pypi/anyjson/0.3.1">anyjson 0.3.1</a> - pypi.python.org</li>
<li><a class="reference external" href="https://bitbucket.org/runeh/anyjson/src/4e162c45cc7c/anyjson/__init__.py">anyjson/__init__.py</a> - bitbucket.org</li>
</ul>
</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="advanced-1.html">デコレータ</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="../index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="advanced-3.html">ネットワークプログラミング</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2012, KITAZAKI Shigeru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>